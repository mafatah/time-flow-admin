<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeFlow - JavaScript Loading Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error { color: #dc2626; }
        .success { color: #16a34a; }
        .warning { color: #ea580c; }
        .info { color: #2563eb; }
        pre { 
            background: #f3f4f6; 
            padding: 15px; 
            border-radius: 4px; 
            overflow-x: auto;
            white-space: pre-wrap;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            border-left: 4px solid #e5e7eb;
            background: #f9fafb;
        }
    </style>
</head>
<body>
    <h1>üîç TimeFlow JavaScript Loading Debugger</h1>
    
    <div class="debug-section">
        <h2>üìä Environment Information</h2>
        <div id="env-info"></div>
    </div>

    <div class="debug-section">
        <h2>üåê Network & Bundle Tests</h2>
        <button onclick="testJSBundles()">Test JS Bundle Loading</button>
        <button onclick="testAPIEndpoint()">Test API Endpoint</button>
        <button onclick="checkConsoleErrors()">Check Console Errors</button>
        <div id="network-results"></div>
    </div>

    <div class="debug-section">
        <h2>üìù Live Console Log</h2>
        <button onclick="clearLog()">Clear Log</button>
        <div id="console-log"></div>
    </div>

    <div class="debug-section">
        <h2>üîß Manual Tests</h2>
        <button onclick="simulateError()">Simulate JS Error</button>
        <button onclick="testModuleImport()">Test Module Import</button>
        <button onclick="testTimeReportsPage()">Load Time Reports Page</button>
    </div>

    <script>
        console.log('üöÄ Debug page loaded');
        
        // Store original console methods
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        // Override console methods to display in page
        function addToLog(message, type = 'info') {
            const logDiv = document.getElementById('console-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog('‚ùå ' + args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog('‚ö†Ô∏è ' + args.join(' '), 'warning');
        };

        // Add global error handlers
        window.addEventListener('error', (event) => {
            addToLog(`Global Error: ${event.message} at ${event.filename}:${event.lineno}`, 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            addToLog(`Unhandled Promise Rejection: ${event.reason}`, 'error');
        });
        
        // Initialize environment info
        function initEnvInfo() {
            const envInfo = document.getElementById('env-info');
            envInfo.innerHTML = `
                <pre>
URL: ${window.location.href}
Origin: ${window.location.origin}
Pathname: ${window.location.pathname}
User Agent: ${navigator.userAgent}
Referrer: ${document.referrer}
Protocol: ${window.location.protocol}
Host: ${window.location.host}
Document Ready State: ${document.readyState}
Local Storage Available: ${!!localStorage}
Session Storage Available: ${!!sessionStorage}
</pre>
            `;
        }
        
        async function testJSBundles() {
            const resultsDiv = document.getElementById('network-results');
            resultsDiv.innerHTML = '<p>üîÑ Testing JavaScript bundle loading...</p>';
            
            const bundlePaths = [
                '/assets/index.js',
                '/assets/index-wvEYJeXC.js',
                '/dist/assets/index.js',
                './assets/index.js'
            ];
            
            let results = '<h3>Bundle Test Results:</h3>';
            
            for (const path of bundlePaths) {
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    if (response.ok) {
                        results += `<p class="success">‚úÖ ${path} - Status: ${response.status}</p>`;
                    } else {
                        results += `<p class="error">‚ùå ${path} - Status: ${response.status}</p>`;
                    }
                } catch (error) {
                    results += `<p class="error">‚ùå ${path} - Error: ${error.message}</p>`;
                }
            }
            
            resultsDiv.innerHTML = results;
        }
        
        async function testAPIEndpoint() {
            try {
                const response = await fetch('/reports/time-reports');
                const text = await response.text();
                
                let result = `<h3>API Test Results:</h3>`;
                result += `<p>Status: ${response.status}</p>`;
                result += `<p>Content-Type: ${response.headers.get('content-type')}</p>`;
                
                if (text.startsWith('<!DOCTYPE html>') || text.includes('<html')) {
                    result += `<p class="error">‚ùå Received HTML instead of expected content</p>`;
                    result += `<pre>${text.substring(0, 500)}...</pre>`;
                } else {
                    result += `<p class="success">‚úÖ Received non-HTML content</p>`;
                }
                
                document.getElementById('network-results').innerHTML = result;
            } catch (error) {
                document.getElementById('network-results').innerHTML = 
                    `<p class="error">‚ùå API Test Error: ${error.message}</p>`;
            }
        }
        
        function checkConsoleErrors() {
            const errorCount = document.querySelectorAll('.log-entry.error').length;
            document.getElementById('network-results').innerHTML = 
                `<p>Console Errors Found: ${errorCount}</p>`;
        }
        
        function clearLog() {
            document.getElementById('console-log').innerHTML = '';
        }
        
        function simulateError() {
            // Simulate the reported error
            try {
                eval('< unexpected token');
            } catch (error) {
                console.error('Simulated syntax error:', error);
            }
        }
        
        function testModuleImport() {
            try {
                // Test dynamic import
                import('./nonexistent-module.js')
                    .catch(error => console.error('Module import test failed:', error));
            } catch (error) {
                console.error('Module import error:', error);
            }
        }
        
        function testTimeReportsPage() {
            console.log('Attempting to navigate to time reports page...');
            window.location.href = '/reports/time-reports';
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initEnvInfo);
        
        console.log('Debug page initialized');
    </script>
</body>
</html> 